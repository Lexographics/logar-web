import"../chunks/CWj6FrbW.js";import{p as bs,a1 as G,w as X,o as gs,f as hs,a as $s,a2 as r,a3 as a,a4 as R,g as s,x as S,a5 as e,a6 as as}from"../chunks/Ddypn_Vl.js";import{d as ks,s as l}from"../chunks/BrL2UJ6-.js";import{i as ts}from"../chunks/DFXQ8BUi.js";import{e as rs,u as z,i as ls,r as H,s as ws}from"../chunks/BHZMxQwG.js";import{t as q,a as f}from"../chunks/BVINg2-B.js";import{b as Y,a as As}from"../chunks/B9uo1nGO.js";import{b as Ls}from"../chunks/BJ4qQQnm.js";import{s as Ms,a as Ss}from"../chunks/Ce7vjTte.js";import{g as Us}from"../chunks/DodE48jg.js";import{B as Cs}from"../chunks/Dq-DC7LE.js";import{u as os,g as Ns}from"../chunks/MmAr2Ipg.js";import{M as Ps}from"../chunks/CgaLH9eL.js";import{h as V}from"../chunks/C5S46NFB.js";import{L as Bs}from"../chunks/BjWez0Tu.js";async function js(E,v,u,J){var g;const[o,b]=await z.createUser(s(v).username,s(v).password,s(v).display_name,s(v).is_admin);b&&console.error(b),S(u,[...s(u),o],!0),(g=s(J))==null||g.closeModal()}var Ds=(E,v,u)=>v(s(u)),Is=q('<li class="card svelte-1qcdyxd" style="list-style: none; display: flex; justify-content: space-between; align-items: center;"><div class="svelte-1qcdyxd"><span class="svelte-1qcdyxd"><span class="bold svelte-1qcdyxd"> </span> <span class="bold svelte-1qcdyxd"> </span></span> <br class="svelte-1qcdyxd"> <span class="svelte-1qcdyxd"><span class="bold svelte-1qcdyxd"> </span> </span> <br class="svelte-1qcdyxd"> <span class="svelte-1qcdyxd"><span class="bold svelte-1qcdyxd"> </span> </span></div> <div class="svelte-1qcdyxd"><button class="danger-button svelte-1qcdyxd"> </button></div></li>'),Rs=q('<span style="color: var(--success-color);" class="blink svelte-1qcdyxd"><div style="background-color: var(--success-color); padding: 0.3rem; margin: 0.1rem; border-radius: 50%; display: inline-block;" class="svelte-1qcdyxd"></div> </span>'),Vs=q('<span style="color: var(--error-color);" class="svelte-1qcdyxd"> </span>'),zs=q('<li class="card svelte-1qcdyxd" style="list-style: none; display: flex; justify-content: space-between; align-items: center;"><div style="display: flex; align-items: center; gap: 1rem;" class="svelte-1qcdyxd"><img alt="avatar" class="avatar svelte-1qcdyxd"> <div class="svelte-1qcdyxd"><span class="svelte-1qcdyxd"><span class="svelte-1qcdyxd"> </span></span> <br class="svelte-1qcdyxd"> <!></div></div></li>'),Es=(E,v)=>{var u;return(u=s(v))==null?void 0:u.openModal()},Fs=q('<button style="margin-top: 1rem;" class="svelte-1qcdyxd">Create User</button>'),Gs=q('<div class="content svelte-1qcdyxd"><h2 class="title svelte-1qcdyxd"> </h2> <h3 style="" class="svelte-1qcdyxd"> </h3> <ul class="item-list svelte-1qcdyxd"></ul> <h3 style="margin-top: 2rem;" class="svelte-1qcdyxd"> </h3> <ul class="item-list svelte-1qcdyxd"></ul> <!> <div style="margin-top: 2rem;" class="svelte-1qcdyxd"></div></div>'),Hs=q('<div style="display: flex; flex-direction: column; gap: 1rem; width: 100%; margin-top: 1rem;" class="svelte-1qcdyxd"><input type="text" placeholder="Username" class="svelte-1qcdyxd"> <input type="text" placeholder="Display Name" class="svelte-1qcdyxd"> <input type="text" placeholder="Password" class="svelte-1qcdyxd"> <label class="svelte-1qcdyxd"><input type="checkbox" class="svelte-1qcdyxd"> <span class="svelte-1qcdyxd">Is Admin</span></label> <button class="svelte-1qcdyxd">Create User</button></div>'),Js=q("<!> <!>",1);function ie(E,v){bs(v,!0);const[u,J]=Ms(),o=()=>Ss(Bs,"$LL",u);let b=G(X([])),g=G(null),_=G(X({username:"",display_name:"",password:"",is_admin:!1}));async function is(d){if(d.is_current){if(!confirm("Are you sure you want to revoke your own session?"))return;await z.logout(),os.current=null,Us(`${Ns()}/login`);return}if(!confirm("Are you sure you want to revoke this session?"))return;const n=await z.revokeSession(d.token);n&&console.error(n),S(b,s(b).filter(i=>i.token!==d.token),!0)}gs(async()=>{const[d,U]=await z.getActiveSessions();U&&console.error(U),S(b,d,!0);const[n,i]=await z.getAllUsers();i&&console.error(i),S(K,n,!0)});let K=G(X([]));var Z=Js(),ss=hs(Z);Cs(ss,{children:(d,U)=>{var n=Gs(),i=a(n),C=a(i,!0);e(i);var h=r(i,2),N=a(h,!0);e(h);var k=r(h,2);rs(k,21,()=>s(b),ls,(m,t)=>{var c=Is(),w=a(c),A=a(w),L=a(A),B=a(L);e(L);var j=r(L),F=r(j),Q=a(F,!0);e(F),e(A);var D=r(A,4),I=a(D),p=a(I);e(I);var x=r(I);e(D);var M=r(D,4),$=a(M),T=a($);e($);var vs=r($);e(M),e(w);var es=r(w,2),W=a(es);W.__click=[Ds,is,t];var _s=a(W,!0);e(W),e(es),e(c),R((ps,us,ys,ms,xs,fs,qs)=>{l(B,`${ps??""}:`),l(j,` ${s(t).device??""} `),l(Q,us),l(p,`${ys??""}:`),l(x,` ${ms??""}`),l(T,`${xs??""}:`),l(vs,` ${fs??""}`),l(_s,qs)},[()=>o().user_sessions.my_active_sessions.device(),()=>s(t).is_current?o().user_sessions.my_active_sessions.you():"",()=>o().user_sessions.my_active_sessions.last_activity(),()=>V(s(t).last_activity).fromNow(),()=>o().user_sessions.my_active_sessions.created_at(),()=>V(s(t).created_at).fromNow(),()=>o().user_sessions.my_active_sessions.revoke()]),f(m,c)}),e(k);var P=r(k,2),y=a(P,!0);e(P);var O=r(P,2);rs(O,21,()=>s(K),ls,(m,t)=>{var c=zs(),w=a(c),A=a(w),L=r(A,2),B=a(L),j=a(B),F=a(j);e(j),e(B);var Q=r(B,4);{var D=p=>{var x=Rs(),M=r(a(x));e(x),R($=>l(M,` ${$??""}`),[()=>o().user_sessions.all_users.online()]),f(p,x)},I=p=>{var x=Vs(),M=a(x);e(x),R(($,T)=>l(M,`${$??""}: ${T??""}`),[()=>o().user_sessions.all_users.last_seen(),()=>V(s(t).last_activity).fromNow()]),f(p,x)};ts(Q,p=>{V(s(t).last_activity).isAfter(V().subtract(10,"second"))?p(D):p(I,!1)})}e(L),e(w),e(c),R(p=>{ws(A,"src",`https://api.dicebear.com/9.x/thumbs/svg?seed=${s(t).username??""}`),l(F,`${s(t).display_name??""} (@${s(t).username??""}) ${p??""}`)},[()=>s(t).is_admin?"("+o().user_sessions.all_users.admin()+")":""]),f(m,c)}),e(O);var cs=r(O,2);{var ds=m=>{var t=Fs();t.__click=[Es,g],f(m,t)};ts(cs,m=>{var t,c;(c=(t=os.current)==null?void 0:t.user)!=null&&c.is_admin&&m(ds)})}as(2),e(n),R((m,t,c)=>{l(C,m),l(N,t),l(y,c)},[()=>o().user_sessions.title(),()=>o().user_sessions.my_active_sessions.title(),()=>o().user_sessions.all_users.title()]),f(d,n)},$$slots:{default:!0}});var ns=r(ss,2);Ls(Ps(ns,{title:"Create User",onClose:()=>{S(_,{username:"",password:"",is_admin:!1},!0)},children:(d,U)=>{var n=Hs(),i=a(n);H(i);var C=r(i,2);H(C);var h=r(C,2);H(h);var N=r(h,2),k=a(N);H(k),as(2),e(N);var P=r(N,2);P.__click=[js,_,K,g],e(n),Y(i,()=>s(_).username,y=>s(_).username=y),Y(C,()=>s(_).display_name,y=>s(_).display_name=y),Y(h,()=>s(_).password,y=>s(_).password=y),As(k,()=>s(_).is_admin,y=>s(_).is_admin=y),f(d,n)},$$slots:{default:!0}}),d=>S(g,d,!0),()=>s(g)),f(E,Z),$s(),J()}ks(["click"]);export{ie as component};
