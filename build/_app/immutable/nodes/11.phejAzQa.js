import"../chunks/CWj6FrbW.js";import{p as gs,a1 as G,w as X,o as hs,f as $s,a as ks,a2 as r,a3 as a,a4 as V,g as s,x as U,a5 as e,a6 as as}from"../chunks/C_K9WeA7.js";import{d as ws,s as l}from"../chunks/DUF1MtVn.js";import{i as ts}from"../chunks/D5T9OJL1.js";import{e as rs,u as z,i as ls,r as H,s as As}from"../chunks/Dlu4oWiR.js";import{t as x,a as b}from"../chunks/COyw5ioR.js";import{b as Y,a as Ls}from"../chunks/B-UvMiJO.js";import{b as Ms}from"../chunks/BqzVn-q-.js";import{s as Ss,a as Us}from"../chunks/CIIlVVW4.js";import{g as Cs}from"../chunks/CnJtoUTT.js";import{B as Ns}from"../chunks/M4sgoBUN.js";import{u as os}from"../chunks/Xh6yIWb-.js";import{M as Ps}from"../chunks/DDzfTnAx.js";import{h as q}from"../chunks/C5S46NFB.js";import{L as js}from"../chunks/Nv5XlIL8.js";async function Bs(E,c,d,J){var h;const[o,g]=await z.createUser(s(c).username,s(c).password,s(c).display_name,s(c).is_admin);g&&console.error(g),U(d,[...s(d),o],!0),(h=s(J))==null||h.closeModal()}var Ds=(E,c,d)=>c(s(d)),Is=x('<li class="card svelte-pse3s5" style="list-style: none; display: flex; justify-content: space-between; align-items: center;"><div class="svelte-pse3s5"><span class="svelte-pse3s5"><span class="bold svelte-pse3s5"> </span> <span class="bold svelte-pse3s5"> </span></span> <br class="svelte-pse3s5"> <span class="svelte-pse3s5"><span class="bold svelte-pse3s5"> </span> </span> <br class="svelte-pse3s5"> <span class="svelte-pse3s5"><span class="bold svelte-pse3s5"> </span> </span></div> <div class="svelte-pse3s5"><button class="danger-button svelte-pse3s5"> </button></div></li>'),Rs=x('<span style="color: var(--success-color);" class="blink svelte-pse3s5"><div style="background-color: var(--success-color); padding: 0.3rem; margin: 0.1rem; border-radius: 50%; display: inline-block;" class="svelte-pse3s5"></div> </span>'),Vs=x('<span style="color: var(--error-color);" class="svelte-pse3s5"> </span>'),qs=x('<li class="card svelte-pse3s5" style="list-style: none; display: flex; justify-content: space-between; align-items: center;"><div style="display: flex; align-items: center; gap: 1rem;" class="svelte-pse3s5"><img alt="avatar" class="avatar svelte-pse3s5"> <div class="svelte-pse3s5"><span class="svelte-pse3s5"><span class="svelte-pse3s5"> </span></span> <br class="svelte-pse3s5"> <!></div></div></li>'),zs=(E,c)=>{var d;return(d=s(c))==null?void 0:d.openModal()},Es=x('<button style="margin-top: 1rem;" class="svelte-pse3s5">Create User</button>'),Fs=x('<div class="content svelte-pse3s5"><h2 class="title svelte-pse3s5"> </h2> <h3 style="" class="svelte-pse3s5"> </h3> <ul class="item-list svelte-pse3s5"></ul> <h3 style="margin-top: 2rem;" class="svelte-pse3s5"> </h3> <ul class="item-list svelte-pse3s5"></ul> <!> <div style="margin-top: 2rem;" class="svelte-pse3s5"></div></div>'),Gs=x('<div style="display: flex; flex-direction: column; gap: 1rem; width: 100%; margin-top: 1rem;" class="svelte-pse3s5"><input type="text" placeholder="Username" class="svelte-pse3s5"> <input type="text" placeholder="Display Name" class="svelte-pse3s5"> <input type="text" placeholder="Password" class="svelte-pse3s5"> <label class="svelte-pse3s5"><input type="checkbox" class="svelte-pse3s5"> <span class="svelte-pse3s5">Is Admin</span></label> <button class="svelte-pse3s5">Create User</button></div>'),Hs=x("<!> <!>",1);function oe(E,c){gs(c,!0);const[d,J]=Ss(),o=()=>Us(js,"$LL",d);let g=G(X([])),h=G(null),_=G(X({username:"",display_name:"",password:"",is_admin:!1}));async function is(p){if(p.is_current){if(!confirm("Are you sure you want to revoke your own session?"))return;await z.logout(),os.current=null,Cs("/login");return}if(!confirm("Are you sure you want to revoke this session?"))return;const n=await z.revokeSession(p.token);n&&console.error(n),U(g,s(g).filter(i=>i.token!==p.token),!0)}hs(async()=>{const[p,C]=await z.getActiveSessions();C&&console.error(C),U(g,p,!0);const[n,i]=await z.getAllUsers();i&&console.error(i),U(K,n,!0)});let K=G(X([]));var Z=Hs(),ss=$s(Z);Ns(ss,{children:(p,C)=>{var n=Fs(),i=a(n),N=a(i,!0);e(i);var $=r(i,2),P=a($,!0);e($);var w=r($,2);rs(w,21,()=>s(g),ls,(y,t)=>{var v=Is(),A=a(v),L=a(A),M=a(L),B=a(M);e(M);var D=r(M),F=r(D),Q=a(F,!0);e(F),e(L);var I=r(L,4),R=a(I),u=a(R);e(R);var f=r(R);e(I);var S=r(I,4),k=a(S),T=a(k);e(k);var cs=r(k);e(S),e(A);var es=r(A,2),W=a(es);W.__click=[Ds,is,t];var _s=a(W,!0);e(W),e(es),e(v),V((us,ds,ms,ys,fs,bs,xs)=>{l(B,`${us??""}:`),l(D,` ${s(t).device??""} `),l(Q,ds),l(u,`${ms??""}:`),l(f,` ${ys??""}`),l(T,`${fs??""}:`),l(cs,` ${bs??""}`),l(_s,xs)},[()=>o().user_sessions.my_active_sessions.device(),()=>s(t).is_current?o().user_sessions.my_active_sessions.you():"",()=>o().user_sessions.my_active_sessions.last_activity(),()=>q(s(t).last_activity).fromNow(),()=>o().user_sessions.my_active_sessions.created_at(),()=>q(s(t).created_at).fromNow(),()=>o().user_sessions.my_active_sessions.revoke()]),b(y,v)}),e(w);var j=r(w,2),m=a(j,!0);e(j);var O=r(j,2);rs(O,21,()=>s(K),ls,(y,t)=>{var v=qs(),A=a(v),L=a(A),M=r(L,2),B=a(M),D=a(B),F=a(D);e(D),e(B);var Q=r(B,4);{var I=u=>{var f=Rs(),S=r(a(f));e(f),V(k=>l(S,` ${k??""}`),[()=>o().user_sessions.all_users.online()]),b(u,f)},R=u=>{var f=Vs(),S=a(f);e(f),V((k,T)=>l(S,`${k??""}: ${T??""}`),[()=>o().user_sessions.all_users.last_seen(),()=>q(s(t).last_activity).fromNow()]),b(u,f)};ts(Q,u=>{q(s(t).last_activity).isAfter(q().subtract(10,"second"))?u(I):u(R,!1)})}e(M),e(A),e(v),V(u=>{As(L,"src",`https://api.dicebear.com/9.x/thumbs/svg?seed=${s(t).username??""}`),l(F,`${s(t).display_name??""} (@${s(t).username??""}) ${u??""}`)},[()=>s(t).is_admin?"("+o().user_sessions.all_users.admin()+")":""]),b(y,v)}),e(O);var vs=r(O,2);{var ps=y=>{var t=Es();t.__click=[zs,h],b(y,t)};ts(vs,y=>{var t,v;(v=(t=os.current)==null?void 0:t.user)!=null&&v.is_admin&&y(ps)})}as(2),e(n),V((y,t,v)=>{l(N,y),l(P,t),l(m,v)},[()=>o().user_sessions.title(),()=>o().user_sessions.my_active_sessions.title(),()=>o().user_sessions.all_users.title()]),b(p,n)},$$slots:{default:!0}});var ns=r(ss,2);Ms(Ps(ns,{title:"Create User",onClose:()=>{U(_,{username:"",password:"",is_admin:!1},!0)},children:(p,C)=>{var n=Gs(),i=a(n);H(i);var N=r(i,2);H(N);var $=r(N,2);H($);var P=r($,2),w=a(P);H(w),as(2),e(P);var j=r(P,2);j.__click=[Bs,_,K,h],e(n),Y(i,()=>s(_).username,m=>s(_).username=m),Y(N,()=>s(_).display_name,m=>s(_).display_name=m),Y($,()=>s(_).password,m=>s(_).password=m),Ls(w,()=>s(_).is_admin,m=>s(_).is_admin=m),b(p,n)},$$slots:{default:!0}}),p=>U(h,p,!0),()=>s(h)),b(E,Z),ks(),J()}ws(["click"]);export{oe as component};
